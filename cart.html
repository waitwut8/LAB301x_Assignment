<!doctype html>
<html lang="en">

<head>
    <title>Title</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <script src="js/interceptor.js"></script>
    <!-- Bootstrap CSS v5.2.1 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
</head>

<body>
    <header>
        <!-- place navbar here -->
    </header>
    <main>
        <p id = "status"></p>
        <div class="container mt-5">
            <h1 class="mb-4">Shopping Cart</h1>
            <div class="card">
                <div class="card-header">
                    <h2>Cart Summary</h2>
                </div>
                <div class="card-body">
                    <p><strong>Total:</strong> $145,651.89</p>
                    <p><strong>Discounted Total:</strong> $128,504.41</p>
                    <p><strong>Total Products:</strong> 3</p>
                    <p><strong>Total Quantity:</strong> 11</p>
                </div>
            </div>
            <div class="card mt-4">
                <div class="card-header">
                    <h2>Products</h2>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <h5>Sportbike Motorcycle</h5>
                        </div>
                        <div class="col-md-2">
                            <p>$7,499.99</p>
                        </div>
                        <div class="col-md-2">
                            <p>Quantity: 2</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8">
                            <p><strong>Total:</strong> $14,999.98</p>
                        </div>
                        <div class="col-md-4">
                            <p><strong>Discounted Total:</strong> $12,025.48</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            console.log(document.cookie)
            token = document.cookie.split("=")[1];

            response = await fetch("http://127.0.0.1:8000/cart", {
                method: "GET",
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })

            let data = await response.json();
            
            console.log(data)
            localStorage.setItem('cart', JSON.stringify(data));
            
                const cart = JSON.parse(localStorage.getItem('cart')) || {};
                console.log(cart);
                
                    
                    console.log(cart)
                    

                    const productsContainer = document.querySelector('.card.mt-4 .card-body');
                    productsContainer.innerHTML = ''; // Clear existing products
                    var sumTotal=0, sumDiscountedTotal=0, sumTotalProducts=0, sumTotalQuantity = 0;
                    cart['products'].forEach(product => {
                        sumTotalProducts += 1;
                        const productRow = document.createElement('div');
                        productRow.classList.add('row', 'mb-3');

                        const productName = document.createElement('div');
                        productName.classList.add('col-md-8');
                        productName.innerHTML = `<h5>${product.title}</h5> `;

                        const productPrice = document.createElement('div');
                        productPrice.classList.add('col-md-2');
                        productPrice.innerHTML = `<p>$${product.price.toFixed(2)}</p>  <img src="${product.thumbnail}" class="img-fluid float-left mr-3" alt="${product.title}" color = "white"/>`;

                        const productQuantity = document.createElement('div');
                        productQuantity.classList.add('col-md-2');
                        productQuantity.innerHTML = `<p>Quantity: ${product.quantity}</p>`;
                        sumTotalQuantity += product.quantity;
                        productRow.appendChild(productName);
                        productRow.appendChild(productPrice);
                        productRow.appendChild(productQuantity);

                        productsContainer.appendChild(productRow);

                        const totalRow = document.createElement('div');
                        totalRow.classList.add('row');

                        const totalPrice = document.createElement('div');
                        totalPrice.classList.add('col-md-8');
                        totalPrice.innerHTML = `<p><strong>Total:</strong> $${product.total.toFixed(2)}</p>`;
                        sumTotal += product.total;
                        const discountedTotalPrice = document.createElement('div');
                        discountedTotalPrice.classList.add('col-md-4');
                        discountedTotalPrice.innerHTML = `<p><strong>Discounted Total:</strong> $${product.discountedTotal.toFixed(2)}</p>`;
                        sumDiscountedTotal += product.discountedTotal;
                        totalRow.appendChild(totalPrice);
                        totalRow.appendChild(discountedTotalPrice);
                        totalRow.appendChild(document.createElement('hr'));
                        
                        productsContainer.appendChild(totalRow);
                        
                        document.querySelector('.card-body p:nth-child(1)').innerText = `Total: $${sumTotal.toFixed(2)}`;
                    
                    
                        document.querySelector('.card-body p:nth-child(2)').innerText = `Discounted Total: $${sumDiscountedTotal.toFixed(2)}`;
                    
                   
                        document.querySelector('.card-body p:nth-child(3)').innerText = `Total Products: ${sumTotalProducts}`;
                   
                        
                    
                        document.querySelector('.card-body p:nth-child(4)').innerText = `Total Quantity: ${sumTotalQuantity}`;
                    
                    });
                });
                
                // You can now use the cart object to update the DOM as needed
            
        
    </script>
    <footer>

        <!-- place footer here -->
    </footer>
    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
        crossorigin="anonymous"></script>
</body>

</html>